---
import { Image } from "astro:assets";
import contactBanner from "../../assets/images/banner-2.jpg";
---

<section id="contacto" class="relative py-32 flex items-center justify-center overflow-hidden bg-slate-900">
    <!-- Background & Overlay -->
    <div id="contact-parallax-bg" class="absolute inset-0 z-0 h-[150%] -top-[25%] w-full pointer-events-none">
        <Image 
            src={contactBanner} 
            class="w-full h-full object-cover" 
            alt="Contact Banner" 
        />
        <div class="absolute inset-0 bg-slate-900/90 mix-blend-multiply"></div>
    </div>

    <div class="site-container relative z-10 text-center text-white pb-20">
        <h2 class="text-4xl md:text-5xl font-gotham mb-6">
            Hablemos de tu Proyecto
        </h2>
        <p class="text-xl font-gotham-rounded opacity-90 max-w-3xl mx-auto">
            ¿Listo para despegar? Contáctanos y transforma tu idea en una realidad digital.
        </p>
    </div>
</section>

<!-- Contact Content (Overlapping) -->
<section class="pb-24 bg-slate-900">
    <div class="site-container relative z-10 -mt-32">
        <div class="max-w-2xl mx-auto">
            <!-- Contact Form -->
            <div class="bg-slate-800 p-8 md:p-10 rounded-3xl shadow-2xl border border-slate-700">
                <!-- Success Message (Hidden by default) -->
                <div id="success-message" class="hidden mb-6 p-4 bg-green-900/30 border border-green-500/30 rounded-xl">
                    <p class="text-green-400 font-gotham-rounded text-center">
                        Envío exitoso. Su solicitud fue enviada satisfactoriamente, lo contactaremos en un plazo máximo de 24 horas.
                    </p>
                </div>

                <!-- Error Message (Hidden by default) -->
                <div id="error-message" class="hidden mb-6 p-4 bg-red-900/30 border border-red-500/30 rounded-xl">
                    <p class="text-red-400 font-gotham-rounded text-center">
                        ❌ Hubo un error al enviar el mensaje. Por favor, intenta nuevamente.
                    </p>
                </div>

                <form id="contact-form" action="https://api.web3forms.com/submit" method="POST" class="space-y-6">
                    <!-- Web3Forms Access Key -->
                    <input type="hidden" name="access_key" value="2faea201-6593-44ad-b994-b5c6a47c9f10">
                    
                    <!-- Honeypot Spam Protection -->
                    <input type="checkbox" name="botcheck" class="hidden" style="display: none;">

                    <!-- Custom Subject -->
                    <input type="hidden" name="subject" value="Nuevo Contacto Web - Infonaut">

                    <!-- Redirect URL (optional) -->
                    <input type="hidden" name="redirect" value="https://infonaut.cl">

                    <div>
                        <label for="name" class="block text-sm font-bold font-gotham text-slate-300 mb-2 uppercase tracking-wide">Nombre Completo</label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            placeholder="Ej: Juan Pérez"
                            required
                            class="w-full px-5 py-4 rounded-xl border border-slate-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all text-white font-gotham-rounded bg-slate-900 focus:bg-slate-900"
                        />
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-sm font-bold font-gotham text-slate-300 mb-2 uppercase tracking-wide">Teléfono</label>
                        <input 
                            type="tel" 
                            id="phone" 
                            name="phone" 
                            placeholder="Ej: +56 9 8765 4321"
                            required
                            class="w-full px-5 py-4 rounded-xl border border-slate-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all text-white font-gotham-rounded bg-slate-900 focus:bg-slate-900"
                        />
                    </div>
                    
                    <div>
                        <label for="email" class="block text-sm font-bold font-gotham text-slate-300 mb-2 uppercase tracking-wide">Correo Electrónico</label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            placeholder="Ej: juan@empresa.com"
                            required
                            class="w-full px-5 py-4 rounded-xl border border-slate-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all text-white font-gotham-rounded bg-slate-900 focus:bg-slate-900"
                        />
                    </div>

                    <div>
                        <label for="message" class="block text-sm font-bold font-gotham text-slate-300 mb-2 uppercase tracking-wide">Mensaje / Comentarios</label>
                        <textarea 
                            id="message" 
                            name="message" 
                            placeholder="Escribe aquí tu mensaje..."
                            rows="4"
                            class="w-full px-5 py-4 rounded-xl border border-slate-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all text-white font-gotham-rounded bg-slate-900 focus:bg-slate-900 resize-none"
                        ></textarea>
                    </div>
                    
                    <button 
                        type="submit" 
                        id="submit-btn"
                        class="w-full py-4 px-8 rounded-xl bg-linear-to-r from-blue-600 to-indigo-600 text-white font-gotham font-bold text-lg hover:shadow-lg hover:shadow-blue-600/40 transform hover:-translate-y-1 transition-all flex justify-center items-center gap-2 border border-blue-500/50"
                    >
                        <span id="btn-text">Contáctenme lo antes posible</span>
                        <svg id="btn-spinner" class="animate-spin h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

<script is:inline>
    // Parallax Effect
    const parallaxBg = document.getElementById('contact-parallax-bg');
    
    if (parallaxBg) {
        window.addEventListener('scroll', () => {
            const scrollValues = window.scrollY;
            const containerTop = parallaxBg.parentElement.offsetTop;
            // Removed offsetHeight since we are looking at parent position primarily
            const windowHeight = window.innerHeight;

            // Only animate when section is roughly in view plus some buffer
            if (scrollValues + windowHeight > containerTop - 100) {
                // Calculate distance from top of section
                const distance = scrollValues - containerTop;
                // Move background slower than scroll (parallax effect)
                // Use a smaller factor (0.3) to control speed and prevent overscrolling
                parallaxBg.style.transform = `translateY(${distance * 0.3}px)`;
            }
        });
    }

    // Form Handling
    const form = document.getElementById('contact-form');
    const submitBtn = document.getElementById('submit-btn');
    const btnText = document.getElementById('btn-text');
    const btnSpinner = document.getElementById('btn-spinner');
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');

    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Show loading state
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
            btnText.textContent = 'Enviando...';
            btnSpinner.classList.remove('hidden');
            
            // Hide previous messages
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');

            const formData = new FormData(form);

            try {
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // Show success message
                    successMessage.classList.remove('hidden');
                    form.reset();
                } else {
                    throw new Error(data.message || 'Error sending message');
                }
            } catch (error) {
                console.error('Error:', error);
                errorMessage.classList.remove('hidden');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                btnText.textContent = 'Contáctenme lo antes posible';
                btnSpinner.classList.add('hidden');
            }
        });
    }
</script>
